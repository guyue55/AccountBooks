{% extends "base.html" %}

{% block title %}商品管理 - AccountBooks{% endblock %}
{% block content %}
  <header class="page-header">
    <div>
      <h1>商品管理</h1>
      <p>管理系统中的所有商品及其定价信息。</p>
    </div>
    <button class="btn btn-primary" onclick="openModal('{% url 'goods_add' %}')">+ 新增商品</button>
  </header>
  <!-- 极简单行筛选 -->
  <form method="get" class="filter-toolbar" id="filterForm">
    <!-- 搜索 -->
    <div class="filter-item filter-item-search">
      <svg class="filter-icon"
           width="15"
           height="15"
           viewBox="0 0 24 24"
           fill="none"
           stroke="currentColor"
           stroke-width="2.5"
           stroke-linecap="round"
           stroke-linejoin="round"
           style="margin-left: 10px;
                  opacity: 0.6">
        <circle cx="11" cy="11" r="8"></circle>
        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
      </svg>
      <input type="text"
             name="q"
             placeholder="搜索商品名称..."
             class="filter-item-input"
             value="{{ request.GET.q|default:'' }}">
    </div>
    <!-- 操作按钮组 (紧跟在后面) -->
    <div class="filter-actions" style="display: flex; gap: 8px;">
      <button type="submit"
              class="btn-filter-icon btn-filter-submit"
              data-tooltip="执行筛选">
        <svg width="18"
             height="18"
             viewBox="0 0 24 24"
             fill="none"
             stroke="currentColor"
             stroke-width="2"
             stroke-linecap="round"
             stroke-linejoin="round">
          <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
        </svg>
      </button>
    </div>
  </form>
  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th class="col-id">ID</th>
          <th>商品名称</th>
          <th>单价（元）</th>
          <th>创建时间</th>
          <th>更新时间</th>
          <th>操作</th>
        </tr>
      </thead>
      <tbody>
        {% for goods in goods_list %}
          <tr>
            <td class="col-id" style="color: var(--text-dim);">{{ goods.id }}</td>
            <td style="font-weight: 500;">{{ goods.goods }}</td>
            <td style="color: var(--accent-green); font-weight: 600;">¥ {{ goods.goods_price }}</td>
            <td style="color: var(--text-dim); font-size: 0.875rem;">{{ goods.created|date:"Y-m-d H:i" }}</td>
            <td style="color: var(--text-dim); font-size: 0.875rem;">{{ goods.updated|date:"Y-m-d H:i" }}</td>
            <td>
              <div class="action-group">
                <button class="action-link action-link-edit"
                        onclick="openModal('{% url 'goods_edit' goods.pk %}')">编辑</button>
                <button class="action-link action-link-delete"
                        onclick="confirmDelete('{% url 'goods_delete' goods.pk %}', '{{ goods.goods }} (¥{{ goods.goods_price }})')">
                  删除
                </button>
              </div>
            </td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="6" class="empty-state">
              <p>暂无商品信息</p>
              <p style="margin-top: 0.5rem; font-size: 0.875rem;">点击右上角「新增商品」开始添加</p>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
    {% if is_paginated %}
      <div class="pagination">
        {% if page_obj.has_previous %}
          <a href="?page={{ page_obj.previous_page_number }}&{{ query_string }}">&laquo;</a>
        {% endif %}
        <span class="current">{{ page_obj.number }} / {{ page_obj.paginator.num_pages }}</span>
        {% if page_obj.has_next %}<a href="?page={{ page_obj.next_page_number }}&{{ query_string }}">&raquo;</a>{% endif %}
      </div>
    {% endif %}
  </div>
{% endblock %}
