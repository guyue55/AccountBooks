name: Cleanup Untagged Images

on:
  schedule:
    # æ¯å¤©å‡Œæ™¨ 2 ç‚¹æ‰§è¡Œä¸€æ¬¡æ‰«æ
    - cron: '0 2 * * *'
  # å…è®¸åœ¨ GitHub Actions ç•Œé¢æ‰‹åŠ¨ç‚¹å‡»è¿è¡Œ
  workflow_dispatch:

jobs:
  cleanup:
    runs-on: ubuntu-latest
    permissions:
      packages: write
      contents: read
    steps:
      - name: ğŸ—‘ï¸ Delete untagged containers
        uses: actions/delete-package-versions@v5
        with:
          package-name: 'accountbooks'
          package-type: 'container'
          # åªåˆ é™¤æ²¡æœ‰æ ‡ç­¾çš„é•œåƒ (sha256:xxx)
          delete-only-untagged-versions: 'true'
          # âš ï¸ ä¸šå†…è¡€æ³ªç»éªŒä¸æ ‡å‡†é…ç½®ï¼š
          # åœ¨å¤šæ¶æ„ (AMD64 + ARM64) æ„å»ºæ—¶ï¼ŒGHCR ä¼šæŠŠå¹³å°åº•å±‚çš„çœŸå®é•œåƒä¹Ÿå­˜ä¸º Untaggedï¼Œ
          # åªæœ‰é¡¶å±‚çš„ Manifest ç´¢å¼•æ‰æœ‰ Tagï¼ˆå³ latest æˆ– v1.1.0ï¼‰ã€‚
          # å¦‚æœæŠŠ Untagged å…¨éƒ¨æ— è„‘åˆ å…‰ï¼Œä¼šå¯¼è‡´ä½ æœ€è¿‘å‘å¸ƒçš„ Tag é•œåƒå› æ‰¾ä¸åˆ°åº•å±‚æ–‡ä»¶è€Œç›´æ¥æŸåå˜ç –ï¼
          # æ ‡å‡†åšæ³•æ˜¯ï¼šåªæ¸…ç†è¿‡æ—§çš„åƒåœ¾ï¼Œä¿ç•™æœ€è¿‘å‡ åä¸ªæœªæ‰“æ ‡ç­¾çš„è®°å½•ä½œä¸ºæ´»è·ƒç¼“å­˜å’Œæ¶æ„åº•å±‚åº“ã€‚
          min-versions-to-keep: 30
          token: ${{ secrets.GITHUB_TOKEN }}
